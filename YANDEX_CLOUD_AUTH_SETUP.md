# Настройка Yandex Cloud Function для аутентификации админ-панели

## Проблема

При использовании `nuxt generate` (статическая генерация) серверные API endpoints (`/api/admin/*`) не работают, так как это статический сайт без сервера.

## Решение

Используйте Yandex Cloud Function для обработки аутентификации, аналогично функции для Telegram.

## Шаги настройки:

### 1. Создайте функцию в Yandex Cloud

1. Перейдите в Yandex Cloud Console
2. Создайте новую функцию (или используйте существующую)
3. Загрузите код из файла `yandex-cloud-function-auth.js`

### 2. Настройте переменные окружения функции

В настройках функции добавьте переменные окружения:

- `ADMIN_PASSWORD` - пароль для входа в админ-панель
- `ADMIN_SECRET_KEY` - секретный ключ для генерации токена (минимум 32 символа)

**Важно:** Используйте те же значения, что и в `.env` файле проекта.

### 3. Получите URL функции

После создания функции вы получите URL вида:
```
https://functions.yandexcloud.net/d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6/admin-auth
```

### 4. Настройте переменную окружения в проекте

Создайте файл `.env` в корне проекта (или добавьте в существующий):

```env
# URL функции Yandex Cloud для аутентификации
AUTH_API_URL=https://functions.yandexcloud.net/ваш-id/имя-функции
```

**Важно:** 
- URL должен указывать на базовый путь функции (без `/login`, `/check`, `/logout`)
- Функция автоматически определяет endpoint по пути запроса

### 5. Настройте функцию для обработки разных путей

Yandex Cloud Function должна обрабатывать следующие пути:
- `POST /login` - вход в систему
- `GET /check` - проверка аутентификации
- `POST /logout` - выход из системы

Функция в `yandex-cloud-function-auth.js` уже настроена для этого.

### 6. Пересоберите проект

```bash
npm run generate
```

### 7. Проверка

После деплоя проверьте:
1. Вход в админ-панель должен работать
2. Проверка аутентификации должна работать
3. Выход должен работать

## Альтернативное решение (SSR)

Если вы можете использовать Node.js сервер, измените сборку:

1. Используйте `nuxt build` вместо `nuxt generate`
2. Запустите сервер: `npm run preview` или используйте Node.js хостинг
3. В этом случае локальные API endpoints будут работать

## Примечания:

- Функция обрабатывает все три типа запросов: login, check, logout
- Автоматически определяет тип запроса по пути
- Поддерживает CORS для работы со статического сайта
- Устанавливает httpOnly cookies для безопасности
- Обрабатывает ошибки и возвращает понятные сообщения

## Безопасность:

- Используйте HTTPS в production
- Установите `secure: true` в функции для cookies (строка 47 в `yandex-cloud-function-auth.js`)
- Регулярно меняйте `ADMIN_PASSWORD` и `ADMIN_SECRET_KEY`
- Не коммитьте `.env` файл в репозиторий

